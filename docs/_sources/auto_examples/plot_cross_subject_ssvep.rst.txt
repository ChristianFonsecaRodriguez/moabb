
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plot_cross_subject_ssvep.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_plot_cross_subject_ssvep.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_cross_subject_ssvep.py:


===========================
Cross-Subject SSVEP
===========================
This example shows how to perform a cross-subject analysis on an SSVEP dataset.
We will compare two pipelines :

- Riemannian Geometry
- CCA

We will use the SSVEP paradigm, which uses the AUC as metric.

.. GENERATED FROM PYTHON SOURCE LINES 13-38

.. code-block:: default

    # Authors: Sylvain Chevallier <sylvain.chevallier@uvsq.fr>
    #
    # License: BSD (3-clause)

    import warnings

    import matplotlib.pyplot as plt
    import pandas as pd
    import seaborn as sns
    from pyriemann.estimation import Covariances
    from pyriemann.tangentspace import TangentSpace
    from sklearn.linear_model import LogisticRegression
    from sklearn.pipeline import make_pipeline

    import moabb
    from moabb.datasets import SSVEPExo
    from moabb.evaluations import CrossSubjectEvaluation
    from moabb.paradigms import SSVEP, FilterBankSSVEP
    from moabb.pipelines import SSVEP_CCA, SSVEP_TRCA, ExtendedSSVEPSignal


    warnings.simplefilter(action="ignore", category=FutureWarning)
    warnings.simplefilter(action="ignore", category=RuntimeWarning)
    moabb.set_log_level("info")








.. GENERATED FROM PYTHON SOURCE LINES 39-48

Loading Dataset
---------------

We will load the data from the first 2 subjects of the ``SSVEP_Exo`` dataset
and compare two algorithms on this set. One of the algorithms could only
process class associated with a stimulation frequency, we will thus drop
the resting class. As the resting class is the last defined class, picking
the first three classes (out of four) allows to focus only on the stimulation
frequency.

.. GENERATED FROM PYTHON SOURCE LINES 48-54

.. code-block:: default


    n_subject = 2
    dataset = SSVEPExo()
    dataset.subject_list = dataset.subject_list[:n_subject]
    interval = dataset.interval








.. GENERATED FROM PYTHON SOURCE LINES 55-66

Choose Paradigm
---------------

We define the paradigms (SSVEP, SSSVEP_TRCA and FilterBankSSVEP) and use the dataset
SSVEPExo. The SSVEP paradigm applied a bandpass filter (10-25 Hz) on
the data, SSVEP_TRCA applied a bandpass filter (1-110 Hz) which correspond to almost
no filtering, while the FilterBankSSVEP paradigm uses as many bandpass filters as
there are stimulation frequencies (here 2). For each stimulation frequency
the EEG is filtered with a 1 Hz-wide bandpass filter centered on the
frequency. This results in ``n_classes`` copies of the signal, filtered for each
class, as used in the filterbank motor imagery paradigms.

.. GENERATED FROM PYTHON SOURCE LINES 66-71

.. code-block:: default


    paradigm = SSVEP(fmin=10, fmax=25, n_classes=3)
    paradigm_TRCA = SSVEP(fmin=1, fmax=110, n_classes=3)
    paradigm_fb = FilterBankSSVEP(filters=None, n_classes=3)








.. GENERATED FROM PYTHON SOURCE LINES 72-76

Classes are defined by the frequency of the stimulation, here we use
the first two frequencies of the dataset, 13 and 17 Hz.
The evaluation function uses a LabelEncoder, transforming them
to 0 and 1

.. GENERATED FROM PYTHON SOURCE LINES 76-79

.. code-block:: default


    freqs = paradigm.used_events(dataset)








.. GENERATED FROM PYTHON SOURCE LINES 80-89

Create Pipelines
----------------

Pipelines must be a dict of sklearn pipeline transformer.
The first pipeline uses Riemannian geometry, by building an extended
covariance matrices from the signal filtered around the considered
frequency and applying a logistic regression in the tangent plane.
The second pipeline relies on the above defined CCA classifier.
The third pipeline relies on the TRCA algorithm.

.. GENERATED FROM PYTHON SOURCE LINES 89-106

.. code-block:: default


    pipelines_fb = {}
    pipelines_fb["RG+LogReg"] = make_pipeline(
        ExtendedSSVEPSignal(),
        Covariances(estimator="lwf"),
        TangentSpace(),
        LogisticRegression(solver="lbfgs", multi_class="auto"),
    )

    pipelines = {}
    pipelines["CCA"] = make_pipeline(SSVEP_CCA(interval=interval, freqs=freqs, n_harmonics=3))

    pipelines_TRCA = {}
    pipelines_TRCA["TRCA"] = make_pipeline(
        SSVEP_TRCA(interval=interval, freqs=freqs, n_fbands=5)
    )








.. GENERATED FROM PYTHON SOURCE LINES 107-116

Evaluation
----------

The evaluation will return a DataFrame containing an accuracy score for
each subject / session of the dataset, and for each pipeline.

Results are saved into the database, so that if you add a new pipeline, it
will not run again the evaluation unless a parameter has changed. Results can
be overwritten if necessary.

.. GENERATED FROM PYTHON SOURCE LINES 116-124

.. code-block:: default


    overwrite = False  # set to True if we want to overwrite cached results

    evaluation = CrossSubjectEvaluation(
        paradigm=paradigm, datasets=dataset, overwrite=overwrite
    )
    results = evaluation.process(pipelines)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|                                              | 0.00/2.06M [00:00<?, ?B/s]      4%|█▍                                    | 80.9k/2.06M [00:00<00:04, 423kB/s]      7%|██▊                                    | 146k/2.06M [00:00<00:05, 369kB/s]      9%|███▍                                   | 184k/2.06M [00:00<00:05, 370kB/s]     11%|████▏                                  | 222k/2.06M [00:00<00:04, 367kB/s]     13%|████▉                                  | 259k/2.06M [00:00<00:04, 363kB/s]     14%|█████▌                                 | 296k/2.06M [00:00<00:05, 334kB/s]     16%|██████▎                                | 330k/2.06M [00:00<00:05, 330kB/s]     18%|██████▉                                | 364k/2.06M [00:01<00:05, 292kB/s]     19%|███████▍                               | 393k/2.06M [00:01<00:05, 289kB/s]     21%|████████                               | 425k/2.06M [00:01<00:05, 291kB/s]     22%|████████▋                              | 458k/2.06M [00:01<00:05, 297kB/s]     24%|█████████▎                             | 490k/2.06M [00:01<00:05, 306kB/s]     25%|█████████▉                             | 523k/2.06M [00:01<00:05, 305kB/s]     27%|██████████▌                            | 556k/2.06M [00:01<00:04, 308kB/s]     29%|███████████▏                           | 589k/2.06M [00:01<00:04, 308kB/s]     30%|███████████▊                           | 622k/2.06M [00:01<00:04, 303kB/s]     33%|████████████▋                          | 671k/2.06M [00:02<00:03, 346kB/s]     35%|█████████████▋                         | 720k/2.06M [00:02<00:04, 317kB/s]     37%|██████████████▌                        | 769k/2.06M [00:02<00:03, 352kB/s]     40%|███████████████▌                       | 818k/2.06M [00:02<00:03, 322kB/s]     42%|████████████████▍                      | 867k/2.06M [00:02<00:03, 354kB/s]     45%|█████████████████▍                     | 916k/2.06M [00:02<00:03, 324kB/s]     47%|██████████████████▎                    | 966k/2.06M [00:02<00:03, 355kB/s]     49%|██████████████████▊                   | 1.01M/2.06M [00:03<00:03, 325kB/s]     52%|███████████████████▋                  | 1.06M/2.06M [00:03<00:02, 356kB/s]     54%|████████████████████▌                 | 1.11M/2.06M [00:03<00:02, 325kB/s]     57%|█████████████████████▍                | 1.16M/2.06M [00:03<00:02, 356kB/s]     59%|██████████████████████▍               | 1.21M/2.06M [00:03<00:02, 323kB/s]     61%|███████████████████████▎              | 1.26M/2.06M [00:03<00:02, 351kB/s]     64%|████████████████████████▏             | 1.31M/2.06M [00:03<00:02, 324kB/s]     67%|█████████████████████████▍            | 1.38M/2.06M [00:04<00:02, 329kB/s]     70%|██████████████████████████▋           | 1.44M/2.06M [00:04<00:01, 333kB/s]     73%|███████████████████████████▊          | 1.51M/2.06M [00:04<00:01, 336kB/s]     77%|█████████████████████████████▎        | 1.59M/2.06M [00:04<00:01, 364kB/s]     80%|██████████████████████████████▌       | 1.65M/2.06M [00:04<00:01, 357kB/s]     84%|███████████████████████████████▊      | 1.72M/2.06M [00:05<00:00, 352kB/s]     87%|█████████████████████████████████     | 1.78M/2.06M [00:05<00:00, 349kB/s]     90%|██████████████████████████████████▏   | 1.85M/2.06M [00:05<00:00, 346kB/s]     93%|███████████████████████████████████▍  | 1.92M/2.06M [00:05<00:00, 344kB/s]     96%|████████████████████████████████████▋ | 1.98M/2.06M [00:05<00:00, 343kB/s]    100%|█████████████████████████████████████▊| 2.05M/2.06M [00:06<00:00, 343kB/s]      0%|                                              | 0.00/2.06M [00:00<?, ?B/s]    100%|█████████████████████████████████████| 2.06M/2.06M [00:00<00:00, 6.87GB/s]
      0%|                                              | 0.00/2.82M [00:00<?, ?B/s]      3%|█                                     | 80.9k/2.82M [00:00<00:06, 419kB/s]      5%|██                                     | 146k/2.82M [00:00<00:07, 373kB/s]      8%|██▉                                    | 212k/2.82M [00:00<00:07, 358kB/s]     10%|███▊                                   | 278k/2.82M [00:00<00:07, 351kB/s]     12%|████▊                                  | 343k/2.82M [00:00<00:07, 347kB/s]     15%|█████▋                                 | 409k/2.82M [00:01<00:06, 344kB/s]     17%|██████▌                                | 474k/2.82M [00:01<00:06, 343kB/s]     19%|███████▍                               | 540k/2.82M [00:01<00:06, 342kB/s]     21%|████████▍                              | 605k/2.82M [00:01<00:06, 342kB/s]     24%|█████████▎                             | 671k/2.82M [00:01<00:06, 341kB/s]     26%|██████████▏                            | 736k/2.82M [00:02<00:06, 341kB/s]     28%|███████████                            | 802k/2.82M [00:02<00:05, 341kB/s]     31%|████████████                           | 867k/2.82M [00:02<00:05, 341kB/s]     33%|████████████▉                          | 933k/2.82M [00:02<00:05, 341kB/s]     35%|█████████████▊                         | 998k/2.82M [00:02<00:05, 341kB/s]     38%|██████████████▌                       | 1.08M/2.82M [00:03<00:04, 366kB/s]     41%|███████████████▍                      | 1.15M/2.82M [00:03<00:04, 359kB/s]     44%|████████████████▊                     | 1.24M/2.82M [00:03<00:03, 404kB/s]     47%|█████████████████▋                    | 1.31M/2.82M [00:03<00:03, 385kB/s]     49%|██████████████████▌                   | 1.38M/2.82M [00:03<00:03, 372kB/s]     51%|███████████████████▍                  | 1.44M/2.82M [00:04<00:03, 362kB/s]     53%|████████████████████▎                 | 1.51M/2.82M [00:04<00:03, 356kB/s]     56%|█████████████████████▏                | 1.57M/2.82M [00:04<00:03, 351kB/s]     58%|██████████████████████                | 1.64M/2.82M [00:04<00:03, 348kB/s]     60%|██████████████████████▉               | 1.70M/2.82M [00:04<00:03, 346kB/s]     63%|███████████████████████▊              | 1.77M/2.82M [00:05<00:03, 344kB/s]     65%|████████████████████████▊             | 1.83M/2.82M [00:05<00:02, 343kB/s]     67%|█████████████████████████▋            | 1.90M/2.82M [00:05<00:02, 343kB/s]     70%|██████████████████████████▌           | 1.97M/2.82M [00:05<00:02, 342kB/s]     72%|███████████████████████████▍          | 2.03M/2.82M [00:05<00:02, 342kB/s]     74%|████████████████████████████▎         | 2.10M/2.82M [00:05<00:02, 341kB/s]     77%|█████████████████████████████▏        | 2.16M/2.82M [00:06<00:01, 341kB/s]     79%|██████████████████████████████        | 2.23M/2.82M [00:06<00:01, 341kB/s]     81%|██████████████████████████████▉       | 2.29M/2.82M [00:06<00:01, 341kB/s]     84%|███████████████████████████████▊      | 2.36M/2.82M [00:06<00:01, 341kB/s]     86%|████████████████████████████████▋     | 2.42M/2.82M [00:06<00:01, 341kB/s]     88%|█████████████████████████████████▌    | 2.49M/2.82M [00:07<00:00, 341kB/s]     91%|██████████████████████████████████▍   | 2.55M/2.82M [00:07<00:00, 341kB/s]     93%|███████████████████████████████████▎  | 2.62M/2.82M [00:07<00:00, 341kB/s]     95%|████████████████████████████████████▏ | 2.69M/2.82M [00:07<00:00, 341kB/s]     98%|█████████████████████████████████████▏| 2.75M/2.82M [00:07<00:00, 341kB/s]      0%|                                              | 0.00/2.82M [00:00<?, ?B/s]    100%|█████████████████████████████████████| 2.82M/2.82M [00:00<00:00, 4.43GB/s]
      0%|                                              | 0.00/2.58M [00:00<?, ?B/s]      3%|█▏                                    | 80.9k/2.58M [00:00<00:05, 419kB/s]      6%|██▏                                    | 146k/2.58M [00:00<00:06, 373kB/s]      8%|███▏                                   | 212k/2.58M [00:00<00:06, 356kB/s]     11%|████▏                                  | 278k/2.58M [00:00<00:06, 350kB/s]     13%|█████▏                                 | 343k/2.58M [00:00<00:06, 346kB/s]     16%|██████▏                                | 409k/2.58M [00:01<00:06, 345kB/s]     18%|███████▏                               | 474k/2.58M [00:01<00:06, 343kB/s]     21%|████████▏                              | 540k/2.58M [00:01<00:05, 342kB/s]     23%|█████████▏                             | 605k/2.58M [00:01<00:05, 341kB/s]     26%|██████████                             | 671k/2.58M [00:01<00:05, 341kB/s]     28%|███████████                            | 736k/2.58M [00:02<00:05, 341kB/s]     31%|████████████                           | 802k/2.58M [00:02<00:05, 341kB/s]     34%|█████████████                          | 867k/2.58M [00:02<00:05, 341kB/s]     36%|██████████████                         | 933k/2.58M [00:02<00:04, 341kB/s]     39%|███████████████                        | 998k/2.58M [00:02<00:04, 341kB/s]     41%|███████████████▋                      | 1.06M/2.58M [00:03<00:04, 341kB/s]     44%|████████████████▌                     | 1.13M/2.58M [00:03<00:04, 341kB/s]     46%|█████████████████▌                    | 1.20M/2.58M [00:03<00:04, 341kB/s]     49%|██████████████████▌                   | 1.26M/2.58M [00:03<00:03, 341kB/s]     51%|███████████████████▌                  | 1.33M/2.58M [00:03<00:03, 341kB/s]     53%|████████████████████▏                 | 1.38M/2.58M [00:03<00:03, 366kB/s]     55%|████████████████████▊                 | 1.41M/2.58M [00:04<00:03, 347kB/s]     56%|█████████████████████▎                | 1.45M/2.58M [00:04<00:03, 350kB/s]     58%|█████████████████████▉                | 1.49M/2.58M [00:04<00:03, 312kB/s]     60%|██████████████████████▋               | 1.54M/2.58M [00:04<00:03, 335kB/s]     61%|███████████████████████▎              | 1.59M/2.58M [00:04<00:03, 322kB/s]     63%|████████████████████████              | 1.64M/2.58M [00:04<00:02, 343kB/s]     65%|████████████████████████▊             | 1.69M/2.58M [00:04<00:02, 327kB/s]     67%|█████████████████████████▌            | 1.74M/2.58M [00:05<00:02, 346kB/s]     69%|██████████████████████████▏           | 1.78M/2.58M [00:05<00:02, 328kB/s]     71%|██████████████████████████▉           | 1.83M/2.58M [00:05<00:02, 348kB/s]     73%|███████████████████████████▋          | 1.88M/2.58M [00:05<00:02, 330kB/s]     75%|████████████████████████████▍         | 1.93M/2.58M [00:05<00:01, 349kB/s]     77%|█████████████████████████████▏        | 1.98M/2.58M [00:05<00:01, 330kB/s]     79%|█████████████████████████████▊        | 2.03M/2.58M [00:05<00:01, 349kB/s]     80%|██████████████████████████████▌       | 2.08M/2.58M [00:06<00:01, 331kB/s]     82%|███████████████████████████████▎      | 2.13M/2.58M [00:06<00:01, 350kB/s]     84%|████████████████████████████████      | 2.18M/2.58M [00:06<00:01, 332kB/s]     86%|████████████████████████████████▊     | 2.23M/2.58M [00:06<00:01, 350kB/s]     88%|█████████████████████████████████▍    | 2.28M/2.58M [00:06<00:00, 331kB/s]     90%|██████████████████████████████████▏   | 2.33M/2.58M [00:06<00:00, 350kB/s]     92%|██████████████████████████████████▉   | 2.37M/2.58M [00:06<00:00, 332kB/s]     94%|███████████████████████████████████▋  | 2.42M/2.58M [00:07<00:00, 350kB/s]     96%|████████████████████████████████████▎ | 2.47M/2.58M [00:07<00:00, 332kB/s]     98%|█████████████████████████████████████ | 2.52M/2.58M [00:07<00:00, 350kB/s]    100%|█████████████████████████████████████▊| 2.57M/2.58M [00:07<00:00, 332kB/s]      0%|                                              | 0.00/2.58M [00:00<?, ?B/s]    100%|█████████████████████████████████████| 2.58M/2.58M [00:00<00:00, 4.55GB/s]
      0%|                                              | 0.00/2.14M [00:00<?, ?B/s]      4%|█▍                                    | 80.9k/2.14M [00:00<00:04, 421kB/s]      7%|██▋                                    | 146k/2.14M [00:00<00:05, 374kB/s]     10%|███▊                                   | 212k/2.14M [00:00<00:05, 359kB/s]     13%|█████                                  | 278k/2.14M [00:00<00:05, 352kB/s]     16%|██████▏                                | 343k/2.14M [00:00<00:05, 348kB/s]     19%|███████▍                               | 409k/2.14M [00:01<00:05, 346kB/s]     22%|████████▋                              | 474k/2.14M [00:01<00:04, 344kB/s]     25%|█████████▊                             | 540k/2.14M [00:01<00:04, 343kB/s]     28%|███████████                            | 605k/2.14M [00:01<00:04, 342kB/s]     34%|█████████████                          | 720k/2.14M [00:01<00:03, 420kB/s]     54%|████████████████████                 | 1.16M/2.14M [00:02<00:00, 1.17MB/s]     70%|█████████████████████████▋           | 1.49M/2.14M [00:02<00:00, 1.35MB/s]     91%|█████████████████████████████████▍   | 1.94M/2.14M [00:02<00:00, 1.99MB/s]      0%|                                              | 0.00/2.14M [00:00<?, ?B/s]    100%|█████████████████████████████████████| 2.14M/2.14M [00:00<00:00, 3.18GB/s]
    Exoskeleton_SSVEP-CrossSubject:   0%|          | 0/2 [00:00<?, ?it/s]    Exoskeleton_SSVEP-CrossSubject:  50%|#####     | 1/2 [00:00<00:00,  4.45it/s]    Exoskeleton_SSVEP-CrossSubject: 100%|##########| 2/2 [00:00<00:00,  4.42it/s]    Exoskeleton_SSVEP-CrossSubject: 100%|##########| 2/2 [00:00<00:00,  4.42it/s]




.. GENERATED FROM PYTHON SOURCE LINES 125-127

Filter bank processing, determine the filter automatically from the
stimulation frequency values of events.

.. GENERATED FROM PYTHON SOURCE LINES 127-133

.. code-block:: default


    evaluation_fb = CrossSubjectEvaluation(
        paradigm=paradigm_fb, datasets=dataset, overwrite=overwrite
    )
    results_fb = evaluation_fb.process(pipelines_fb)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Exoskeleton_SSVEP-CrossSubject:   0%|          | 0/2 [00:00<?, ?it/s]    Exoskeleton_SSVEP-CrossSubject:  50%|#####     | 1/2 [00:00<00:00,  8.50it/s]    Exoskeleton_SSVEP-CrossSubject: 100%|##########| 2/2 [00:00<00:00,  8.39it/s]    Exoskeleton_SSVEP-CrossSubject: 100%|##########| 2/2 [00:00<00:00,  8.40it/s]




.. GENERATED FROM PYTHON SOURCE LINES 134-135

TRCA processing also relies on filter bank that is automatically designed.

.. GENERATED FROM PYTHON SOURCE LINES 135-141

.. code-block:: default


    evaluation_TRCA = CrossSubjectEvaluation(
        paradigm=paradigm_TRCA, datasets=dataset, overwrite=overwrite
    )
    results_TRCA = evaluation_TRCA.process(pipelines_TRCA)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Exoskeleton_SSVEP-CrossSubject:   0%|          | 0/2 [00:00<?, ?it/s]    Exoskeleton_SSVEP-CrossSubject:  50%|#####     | 1/2 [00:00<00:00,  1.06it/s]    Exoskeleton_SSVEP-CrossSubject: 100%|##########| 2/2 [00:01<00:00,  1.05it/s]    Exoskeleton_SSVEP-CrossSubject: 100%|##########| 2/2 [00:01<00:00,  1.05it/s]




.. GENERATED FROM PYTHON SOURCE LINES 142-143

After processing the three, we simply concatenate the results.

.. GENERATED FROM PYTHON SOURCE LINES 143-146

.. code-block:: default


    results = pd.concat([results, results_fb, results_TRCA])








.. GENERATED FROM PYTHON SOURCE LINES 147-151

Plot Results
----------------

Here we display the results as stripplot, with a pointplot for error bar.

.. GENERATED FROM PYTHON SOURCE LINES 151-167

.. code-block:: default


    fig, ax = plt.subplots(facecolor="white", figsize=[8, 4])
    sns.stripplot(
        data=results,
        y="score",
        x="pipeline",
        ax=ax,
        jitter=True,
        alpha=0.5,
        zorder=1,
        palette="Set1",
    )
    sns.pointplot(data=results, y="score", x="pipeline", ax=ax, palette="Set1")
    ax.set_ylabel("Accuracy")
    ax.set_ylim(0.1, 0.6)
    plt.show()



.. image-sg:: /auto_examples/images/sphx_glr_plot_cross_subject_ssvep_001.png
   :alt: plot cross subject ssvep
   :srcset: /auto_examples/images/sphx_glr_plot_cross_subject_ssvep_001.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  33.265 seconds)


.. _sphx_glr_download_auto_examples_plot_cross_subject_ssvep.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_cross_subject_ssvep.py <plot_cross_subject_ssvep.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_cross_subject_ssvep.ipynb <plot_cross_subject_ssvep.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
