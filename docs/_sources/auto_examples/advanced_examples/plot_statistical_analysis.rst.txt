
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/advanced_examples/plot_statistical_analysis.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_advanced_examples_plot_statistical_analysis.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_advanced_examples_plot_statistical_analysis.py:


=======================
Statistical Analysis
=======================

The MOABB codebase comes with convenience plotting utilities and some
statistical testing. This tutorial focuses on what those exactly are and how
they can be used.

.. GENERATED FROM PYTHON SOURCE LINES 11-39

.. code-block:: default

    # Authors: Vinay Jayaram <vinayjayaram13@gmail.com>
    #
    # License: BSD (3-clause)
    # sphinx_gallery_thumbnail_number = -2

    import matplotlib.pyplot as plt
    from mne.decoding import CSP
    from pyriemann.estimation import Covariances
    from pyriemann.tangentspace import TangentSpace
    from sklearn.discriminant_analysis import LinearDiscriminantAnalysis as LDA
    from sklearn.linear_model import LogisticRegression
    from sklearn.pipeline import make_pipeline

    import moabb
    import moabb.analysis.plotting as moabb_plt
    from moabb.analysis.meta_analysis import (  # noqa: E501
        compute_dataset_statistics,
        find_significant_differences,
    )
    from moabb.datasets import BNCI2014001
    from moabb.evaluations import CrossSessionEvaluation
    from moabb.paradigms import LeftRightImagery


    moabb.set_log_level("info")

    print(__doc__)








.. GENERATED FROM PYTHON SOURCE LINES 40-58

Results Generation
---------------------

First we need to set up a paradigm, dataset list, and some pipelines to
test. This is explored more in the examples -- we choose left vs right
imagery paradigm with a single bandpass. There is only one dataset here but
any number can be added without changing this workflow.

Create Pipelines
----------------

Pipelines must be a dict of sklearn pipeline transformer.

The CSP implementation from MNE is used. We selected 8 CSP components, as
usually done in the literature.

The Riemannian geometry pipeline consists in covariance estimation, tangent
space mapping and finally a logistic regression for the classification.

.. GENERATED FROM PYTHON SOURCE LINES 58-69

.. code-block:: default


    pipelines = {}

    pipelines["CSP+LDA"] = make_pipeline(CSP(n_components=8), LDA())

    pipelines["RG+LR"] = make_pipeline(Covariances(), TangentSpace(), LogisticRegression())

    pipelines["CSP+LR"] = make_pipeline(CSP(n_components=8), LogisticRegression())

    pipelines["RG+LDA"] = make_pipeline(Covariances(), TangentSpace(), LDA())








.. GENERATED FROM PYTHON SOURCE LINES 70-80

Evaluation
----------

We define the paradigm (LeftRightImagery) and the dataset (BNCI2014001).
The evaluation will return a DataFrame containing a single AUC score for
each subject / session of the dataset, and for each pipeline.

Results are saved into the database, so that if you add a new pipeline, it
will not run again the evaluation unless a parameter has changed. Results can
be overwritten if necessary.

.. GENERATED FROM PYTHON SOURCE LINES 80-92

.. code-block:: default


    paradigm = LeftRightImagery()
    dataset = BNCI2014001()
    dataset.subject_list = dataset.subject_list[:4]
    datasets = [dataset]
    overwrite = True  # set to False if we want to use cached results
    evaluation = CrossSessionEvaluation(
        paradigm=paradigm, datasets=datasets, suffix="stats", overwrite=overwrite
    )

    results = evaluation.process(pipelines)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    001-2014-CrossSession:   0%|          | 0/4 [00:00<?, ?it/s]    001-2014-CrossSession:  25%|##5       | 1/4 [00:06<00:18,  6.14s/it]    001-2014-CrossSession:  50%|#####     | 2/4 [00:12<00:12,  6.03s/it]
      0%|                                              | 0.00/44.1M [00:00<?, ?B/s]
      0%|                                     | 8.19k/44.1M [00:00<14:48, 49.6kB/s]
      0%|                                      | 32.8k/44.1M [00:00<06:52, 107kB/s]
      0%|                                      | 88.1k/44.1M [00:00<03:31, 208kB/s]
      0%|▏                                      | 184k/44.1M [00:00<02:04, 351kB/s]
      1%|▎                                      | 392k/44.1M [00:00<01:05, 670kB/s]
      2%|▋                                     | 816k/44.1M [00:01<00:33, 1.30MB/s]
      4%|█▍                                   | 1.65M/44.1M [00:01<00:17, 2.49MB/s]
      8%|██▊                                  | 3.33M/44.1M [00:01<00:08, 4.86MB/s]
     13%|████▊                                | 5.70M/44.1M [00:01<00:04, 7.75MB/s]
     18%|██████▍                              | 7.72M/44.1M [00:01<00:04, 9.05MB/s]
     23%|████████▍                            | 9.99M/44.1M [00:01<00:03, 10.4MB/s]
     27%|██████████▏                          | 12.1M/44.1M [00:02<00:02, 11.0MB/s]
     33%|████████████                         | 14.3M/44.1M [00:02<00:02, 11.7MB/s]
     37%|█████████████▊                       | 16.4M/44.1M [00:02<00:02, 11.9MB/s]
     42%|███████████████▌                     | 18.6M/44.1M [00:02<00:02, 12.2MB/s]
     47%|█████████████████▍                   | 20.8M/44.1M [00:02<00:01, 12.4MB/s]
     52%|███████████████████▎                 | 23.0M/44.1M [00:02<00:01, 12.6MB/s]
     57%|█████████████████████                | 25.1M/44.1M [00:03<00:01, 12.7MB/s]
     62%|██████████████████████▉              | 27.3M/44.1M [00:03<00:01, 12.7MB/s]
     67%|████████████████████████▊            | 29.5M/44.1M [00:03<00:01, 12.8MB/s]
     72%|██████████████████████████▌          | 31.7M/44.1M [00:03<00:00, 12.8MB/s]
     77%|████████████████████████████▍        | 33.9M/44.1M [00:03<00:00, 12.9MB/s]
     82%|██████████████████████████████▎      | 36.1M/44.1M [00:03<00:00, 12.9MB/s]
     87%|████████████████████████████████▏    | 38.3M/44.1M [00:04<00:00, 13.0MB/s]
     92%|█████████████████████████████████▉   | 40.5M/44.1M [00:04<00:00, 13.0MB/s]
     97%|███████████████████████████████████▉ | 42.8M/44.1M [00:04<00:00, 13.2MB/s]
      0%|                                              | 0.00/44.1M [00:00<?, ?B/s]    100%|█████████████████████████████████████| 44.1M/44.1M [00:00<00:00, 52.3GB/s]

      0%|                                              | 0.00/42.3M [00:00<?, ?B/s]
      0%|                                     | 8.19k/42.3M [00:00<14:12, 49.6kB/s]
      0%|                                      | 32.8k/42.3M [00:00<06:36, 107kB/s]
      0%|                                      | 96.3k/42.3M [00:00<03:03, 231kB/s]
      0%|▏                                      | 209k/42.3M [00:00<01:44, 404kB/s]
      1%|▍                                      | 432k/42.3M [00:00<00:56, 737kB/s]
      2%|▊                                     | 889k/42.3M [00:01<00:29, 1.41MB/s]
      4%|█▌                                   | 1.80M/42.3M [00:01<00:14, 2.72MB/s]
      9%|███▏                                 | 3.62M/42.3M [00:01<00:07, 5.30MB/s]
     14%|█████▏                               | 5.90M/42.3M [00:01<00:04, 7.86MB/s]
     19%|██████▉                              | 7.97M/42.3M [00:01<00:03, 9.24MB/s]
     24%|████████▉                            | 10.2M/42.3M [00:01<00:03, 10.4MB/s]
     29%|██████████▋                          | 12.2M/42.3M [00:02<00:02, 11.0MB/s]
     34%|████████████▋                        | 14.5M/42.3M [00:02<00:02, 11.7MB/s]
     39%|██████████████▌                      | 16.6M/42.3M [00:02<00:02, 12.0MB/s]
     45%|████████████████▍                    | 18.8M/42.3M [00:02<00:01, 12.3MB/s]
     50%|██████████████████▎                  | 21.0M/42.3M [00:02<00:01, 12.5MB/s]
     55%|████████████████████▎                | 23.2M/42.3M [00:02<00:01, 12.6MB/s]
     60%|██████████████████████▏              | 25.4M/42.3M [00:03<00:01, 12.7MB/s]
     65%|████████████████████████             | 27.5M/42.3M [00:03<00:01, 12.8MB/s]
     70%|█████████████████████████▉           | 29.7M/42.3M [00:03<00:00, 12.8MB/s]
     75%|███████████████████████████▊         | 31.8M/42.3M [00:03<00:00, 12.7MB/s]
     80%|█████████████████████████████▋       | 34.0M/42.3M [00:03<00:00, 12.8MB/s]
     86%|███████████████████████████████▋     | 36.2M/42.3M [00:03<00:00, 12.9MB/s]
     91%|█████████████████████████████████▌   | 38.3M/42.3M [00:04<00:00, 12.8MB/s]
     96%|███████████████████████████████████▍ | 40.6M/42.3M [00:04<00:00, 13.0MB/s]
      0%|                                              | 0.00/42.3M [00:00<?, ?B/s]    100%|█████████████████████████████████████| 42.3M/42.3M [00:00<00:00, 87.5GB/s]
    001-2014-CrossSession:  75%|#######5  | 3/4 [00:30<00:11, 11.89s/it]
      0%|                                              | 0.00/37.2M [00:00<?, ?B/s]
      0%|                                     | 8.19k/37.2M [00:00<12:27, 49.7kB/s]
      0%|                                      | 32.8k/37.2M [00:00<05:48, 106kB/s]
      0%|                                      | 96.3k/37.2M [00:00<02:40, 230kB/s]
      1%|▏                                      | 209k/37.2M [00:00<01:31, 404kB/s]
      1%|▍                                      | 432k/37.2M [00:00<00:49, 736kB/s]
      2%|▉                                     | 889k/37.2M [00:01<00:25, 1.41MB/s]
      5%|█▊                                   | 1.80M/37.2M [00:01<00:13, 2.72MB/s]
     10%|███▌                                 | 3.62M/37.2M [00:01<00:06, 5.29MB/s]
     18%|██████▌                              | 6.58M/37.2M [00:01<00:03, 9.13MB/s]
     24%|████████▊                            | 8.83M/37.2M [00:01<00:02, 10.4MB/s]
     31%|███████████▍                         | 11.5M/37.2M [00:01<00:02, 12.0MB/s]
     38%|█████████████▉                       | 14.0M/37.2M [00:02<00:01, 12.7MB/s]
     45%|████████████████▌                    | 16.7M/37.2M [00:02<00:01, 13.7MB/s]
     52%|███████████████████▎                 | 19.4M/37.2M [00:02<00:01, 14.4MB/s]
     59%|█████████████████████▊               | 21.9M/37.2M [00:02<00:01, 14.5MB/s]
     66%|████████████████████████▎            | 24.4M/37.2M [00:02<00:00, 14.7MB/s]
     73%|██████████████████████████▉          | 27.0M/37.2M [00:02<00:00, 14.9MB/s]
     80%|█████████████████████████████▌       | 29.7M/37.2M [00:03<00:00, 15.1MB/s]
     87%|████████████████████████████████▏    | 32.3M/37.2M [00:03<00:00, 15.3MB/s]
     94%|██████████████████████████████████▊  | 34.9M/37.2M [00:03<00:00, 15.4MB/s]
      0%|                                              | 0.00/37.2M [00:00<?, ?B/s]    100%|█████████████████████████████████████| 37.2M/37.2M [00:00<00:00, 60.8GB/s]

      0%|                                              | 0.00/41.7M [00:00<?, ?B/s]
      0%|                                     | 8.19k/41.7M [00:00<13:59, 49.7kB/s]
      0%|                                      | 32.8k/41.7M [00:00<06:30, 107kB/s]
      0%|                                      | 96.3k/41.7M [00:00<03:00, 231kB/s]
      1%|▏                                      | 209k/41.7M [00:00<01:42, 404kB/s]
      1%|▍                                      | 432k/41.7M [00:00<00:56, 737kB/s]
      2%|▊                                     | 889k/41.7M [00:01<00:28, 1.41MB/s]
      4%|█▌                                   | 1.80M/41.7M [00:01<00:14, 2.72MB/s]
      9%|███▏                                 | 3.62M/41.7M [00:01<00:07, 5.30MB/s]
     16%|█████▊                               | 6.58M/41.7M [00:01<00:03, 9.14MB/s]
     22%|████████                             | 9.12M/41.7M [00:01<00:03, 10.8MB/s]
     27%|██████████▏                          | 11.4M/41.7M [00:01<00:02, 11.7MB/s]
     34%|████████████▍                        | 14.1M/41.7M [00:02<00:02, 12.9MB/s]
     40%|██████████████▋                      | 16.6M/41.7M [00:02<00:01, 13.4MB/s]
     46%|████████████████▊                    | 19.0M/41.7M [00:02<00:01, 13.8MB/s]
     52%|███████████████████▏                 | 21.6M/41.7M [00:02<00:01, 14.2MB/s]
     58%|█████████████████████▍               | 24.1M/41.7M [00:02<00:01, 14.5MB/s]
     64%|███████████████████████▌             | 26.6M/41.7M [00:02<00:01, 14.6MB/s]
     70%|█████████████████████████▊           | 29.1M/41.7M [00:03<00:00, 14.7MB/s]
     76%|████████████████████████████         | 31.7M/41.7M [00:03<00:00, 14.9MB/s]
     82%|██████████████████████████████▎      | 34.2M/41.7M [00:03<00:00, 14.9MB/s]
     88%|████████████████████████████████▍    | 36.6M/41.7M [00:03<00:00, 14.6MB/s]
     94%|██████████████████████████████████▋  | 39.1M/41.7M [00:03<00:00, 14.7MB/s]
    100%|████████████████████████████████████▉| 41.6M/41.7M [00:03<00:00, 14.8MB/s]
      0%|                                              | 0.00/41.7M [00:00<?, ?B/s]    100%|█████████████████████████████████████| 41.7M/41.7M [00:00<00:00, 90.9GB/s]
    001-2014-CrossSession: 100%|##########| 4/4 [00:47<00:00, 13.79s/it]    001-2014-CrossSession: 100%|##########| 4/4 [00:47<00:00, 11.91s/it]




.. GENERATED FROM PYTHON SOURCE LINES 93-99

MOABB Plotting
----------------

Here we plot the results using some of the convenience methods within the
toolkit.  The score_plot visualizes all the data with one score per subject
for every dataset and pipeline.

.. GENERATED FROM PYTHON SOURCE LINES 99-103

.. code-block:: default


    fig = moabb_plt.score_plot(results)
    plt.show()




.. image-sg:: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_001.png
   :alt: Scores per dataset and algorithm
   :srcset: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    /home/runner/work/moabb/moabb/moabb/analysis/plotting.py:59: UserWarning: The palette list has more values (6) than needed (4), which may not be intended.
      sea.stripplot(




.. GENERATED FROM PYTHON SOURCE LINES 104-108

For a comparison of two algorithms, there is the paired_plot, which plots
performance in one versus the performance in the other over all chosen
datasets. Note that there is only one score per subject, regardless of the
number of sessions.

.. GENERATED FROM PYTHON SOURCE LINES 108-112

.. code-block:: default


    fig = moabb_plt.paired_plot(results, "CSP+LDA", "RG+LDA")
    plt.show()




.. image-sg:: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_002.png
   :alt: plot statistical analysis
   :srcset: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 113-121

Statistical Testing and Further Plots
----------------------------------------

If the statistical significance of results is of interest, the method
compute_dataset_statistics allows one to show a meta-analysis style plot as
well. For an overview of how all algorithms perform in comparison with each
other, the method find_significant_differences and the summary_plot are
possible.

.. GENERATED FROM PYTHON SOURCE LINES 121-125

.. code-block:: default


    stats = compute_dataset_statistics(results)
    P, T = find_significant_differences(stats)








.. GENERATED FROM PYTHON SOURCE LINES 126-129

The meta-analysis style plot shows the standardized mean difference within
each tested dataset for the two algorithms in question, in addition to a
meta-effect and significance both per-dataset and overall.

.. GENERATED FROM PYTHON SOURCE LINES 129-132

.. code-block:: default

    fig = moabb_plt.meta_analysis_plot(stats, "CSP+LDA", "RG+LDA")
    plt.show()




.. image-sg:: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_003.png
   :alt: < RG+LDA better                                                                              CSP+LDA better >, p-value
   :srcset: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_003.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 133-136

The summary plot shows the effect and significance related to the hypothesis
that the algorithm on the y-axis significantly outperformed the algorithm on
the x-axis over all datasets

.. GENERATED FROM PYTHON SOURCE LINES 136-138

.. code-block:: default

    moabb_plt.summary_plot(P, T)
    plt.show()



.. image-sg:: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_004.png
   :alt: Algorithm comparison
   :srcset: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_004.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  48.434 seconds)


.. _sphx_glr_download_auto_examples_advanced_examples_plot_statistical_analysis.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example


    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_statistical_analysis.py <plot_statistical_analysis.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_statistical_analysis.ipynb <plot_statistical_analysis.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
